<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JR AI Chat</title>
    <script src="https://js.puter.com/v2/"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <!-- CodeMirror for code editor -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <!-- Leaflet for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <div class="app-container">
        <header>
            <div class="header-flex-container">
                <div class="logo-container">
                    <div class="stacked-logo">
                        <div class="logo-top">JR AI</div>
                        <div class="logo-bottom">Chat</div>
                    </div>
                </div>
                <div class="model-selector-container">
                    <select id="model-selector">
                        <option value="gpt-4o-mini" selected>GPT-4o Mini (Default)</option>
                        <option value="gpt-4o">GPT-4o</option>
                        <option value="o3-mini">O3 Mini</option>
                        <option value="claude-3-7-sonnet">Claude 3.7 Sonnet</option>
                        <option value="claude-3-5-sonnet">Claude 3.5 Sonnet</option>
                        <option value="deepseek-chat">DeepSeek Chat</option>
                        <option value="deepseek-reasoner">DeepSeek Reasoner</option>
                        <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                        <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                        <option value="meta-llama/Meta-Llama-3.1-8B-Instruct-Turbo">Meta Llama 3.1 8B</option>
                        <option value="meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo">Meta Llama 3.1 70B</option>
                        <option value="meta-llama/Meta-Llama-3.1-405B-Instruct-Turbo">Meta Llama 3.1 405B</option>
                        <option value="mistral-large-latest">Mistral Large</option>
                        <option value="pixtral-large-latest">Pixtral Large</option>
                        <option value="codestral-latest">Codestral</option>
                        <option value="google/gemma-2-27b-it">Gemma 2 27B</option>
                        <option value="grok-beta">Grok Beta</option>
                    </select>
                </div>
                <div class="header-controls">
                    <div id="env-indicator" title="Puter Environment">
                        <i class="fas fa-server"></i>
                        <span id="env-type"></span>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <div class="chat-container">
                <div id="thinking-indicator" style="display: none;">
                    <span id="thinking-model">Think: DeepSeek</span>
                </div>
                <div id="chat-history"></div>
                <div id="thinking-box" style="display: none;">
                    <div class="thinking-content">
                        <h4>Model Thinking/Reasoning:</h4>
                        <div id="thinking-text"></div>
                        <button id="minimize-thinking-btn">Minimize</button>
                    </div>
                </div>

                <div id="terminal-box" style="display: none;">
                    <div class="terminal-content">
                        <h4>Terminal Calls:</h4>
                        <div id="terminal-text"></div>
                        <button id="minimize-terminal-btn">Minimize</button>
                        <button id="clear-terminal-btn">Clear</button>
                    </div>
                </div>

                <!-- Utility Bar -->
                <div class="utility-bar">
                    <button id="new-chat-btn" class="icon-btn" title="New Chat"><i class="fas fa-plus"></i></button>
                    <button id="chat-history-btn" class="icon-btn" title="Chat History"><i class="fas fa-history"></i></button>
                    <button id="image-upload-btn" class="icon-btn" title="Image Upload"><i class="fas fa-image"></i></button>
                    <button id="file-upload-btn" class="icon-btn" title="File Upload"><i class="fas fa-file"></i></button>
                    <button id="code-editor-btn" class="icon-btn" title="Code Editor"><i class="fas fa-code"></i></button>
                    <button id="knowledge-base-btn" class="icon-btn" title="Knowledge Base"><i class="fas fa-archive"></i></button>
                    <button id="reasoning-btn" class="icon-btn" title="Reasoning"><i class="fas fa-brain"></i></button>
                    <button id="web-url-btn" class="icon-btn" title="Web URL"><i class="fas fa-globe"></i></button>
                    <button id="tools-btn" class="icon-btn" title="Tools"><i class="fas fa-tools"></i></button>
                    <button id="mcp-btn" class="icon-btn" title="MCP"><i class="fas fa-server"></i></button>
                    <button id="ai-features-btn" class="icon-btn" title="AI Features"><i class="fas fa-robot"></i></button>
                    <button id="settings-btn" class="icon-btn" title="Settings"><i class="fas fa-cog"></i></button>
                </div>

                <div class="input-container">
                    <div class="message-input-area">
                        <div class="input-with-resize">
                            <div class="resize-handle" id="resize-handle" title="Drag to resize"></div>
                            <textarea id="message-input" placeholder="Type your message here..."></textarea>
                        </div>
                        <div class="input-buttons">
                            <button id="mic-btn" class="icon-btn" title="Voice Input"><i class="fas fa-microphone"></i></button>
                            <button id="send-btn">Send</button>
                            <button id="tts-btn" class="icon-btn" title="Text to Speech" style="display: none;"><i class="fas fa-volume-up"></i></button>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="footer">
                    <p>Created by <a href="https://jayreddin.github.io" target="_blank">Jamie Reddin</a> Using <a href="https://puter.com" target="_blank">Puter.com</a></p>
                </div>
            </div>
        </main>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal">
            <div class="modal-content">
                <h3>Settings</h3>
                <div class="settings-tabs">
                    <button class="tab-btn active" data-tab="general">General</button>
                    <button class="tab-btn" data-tab="ai">AI</button>
                    <button class="tab-btn" data-tab="privacy">Privacy</button>
                </div>

                <div class="settings-container">
                    <!-- General Tab -->
                    <div class="tab-content active" id="general-tab">
                        <div class="feature-section">
                            <h4>Appearance</h4>
                            <div class="setting-options-row">
                                <div class="setting-option">
                                    <label for="dark-mode-toggle">Dark Mode:</label>
                                    <label class="switch">
                                        <input type="checkbox" id="dark-mode-toggle">
                                        <span class="slider round"></span>
                                    </label>
                                </div>

                                <div class="setting-option">
                                    <label for="terminal-calls-toggle">Terminal Calls:</label>
                                    <label class="switch">
                                        <input type="checkbox" id="terminal-calls-toggle">
                                        <span class="slider round"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="setting-options-row">
                                <div class="setting-option">
                                    <button id="compact-mode-btn" class="feature-btn">Compact Mode</button>
                                </div>
                                <div class="setting-option">
                                    <button id="memory-mode-btn" class="feature-btn">Memory</button>
                                </div>
                            </div>

                            <div class="setting-option">
                                <label for="text-size-slider">Text Size:</label>
                                <div class="slider-container">
                                    <input type="range" min="60" max="200" value="100" class="range-slider" id="text-size-slider">
                                    <input type="number" min="60" max="200" value="100" id="text-size-input">
                                    <span>%</span>
                                </div>
                            </div>
                        </div>

                        <div class="feature-section">
                            <h4>Units</h4>
                            <div class="setting-options-row">
                                <div class="setting-option">
                                    <label>Temperature:</label>
                                    <select id="temp-unit">
                                        <option value="C" selected>Celsius</option>
                                        <option value="F">Fahrenheit</option>
                                    </select>
                                </div>

                                <div class="setting-option">
                                    <label>Distance:</label>
                                    <select id="distance-unit">
                                        <option value="km" selected>Kilometers</option>
                                        <option value="mi">Miles</option>
                                    </select>
                                </div>
                            </div>

                            <div class="setting-options-row">
                                <div class="setting-option">
                                    <label for="date-format">Date Format:</label>
                                    <select id="date-format">
                                        <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                        <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                        <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                    </select>
                                </div>

                                <div class="setting-option">
                                    <label for="time-format">Time Format:</label>
                                    <select id="time-format">
                                        <option value="12h">12-hour (AM/PM)</option>
                                        <option value="24h">24-hour</option>
                                    </select>
                                </div>
                            </div>

                            <div class="setting-option">
                                <button id="location-access-btn" class="feature-btn">Enable Precise Location</button>
                            </div>
                            
                            <div id="location-display" style="display: none;">
                                <div class="location-box">
                                    <div class="location-coordinates" id="location-coords"></div>
                                    <div id="location-map" style="height: 200px; width: 100%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Tab -->
                    <div class="tab-content" id="ai-tab">
                        <div class="feature-section">
                            <h4>System Prompt</h4>
                            <textarea id="system-prompt" placeholder="Enter a system prompt for the AI..."></textarea>
                            <button id="save-system-prompt" class="feature-btn">Save Prompt</button>
                        </div>

                        <div class="feature-section">
                            <h4>Function Calling Demo</h4>
                            <div class="function-demo">
                                <p>Ask about the weather in any city</p>
                                <div id="function-result"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Privacy Tab -->
                    <div class="tab-content" id="privacy-tab">
                        <div class="feature-section">
                            <h4>Data Management</h4>
                            <div class="settings-options">
                                <button id="export-chat-btn" class="feature-btn">Export Current Conversation</button>
                                <button id="export-all-btn" class="feature-btn">Export All Conversations</button>
                                <button id="clear-all-btn" class="feature-btn">Clear All Conversations</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-buttons">
                    <button id="save-settings-btn">Save</button>
                    <button id="cancel-settings-btn">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Modal for image upload -->
        <div id="upload-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Upload Image</h3>
                <input type="file" id="image-upload" accept="image/*">
                <div id="preview-container"></div>
                <button id="process-image-btn">Process Image</button>
            </div>
        </div>

        <!-- Modal for text to image -->
        <div id="txt2img-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Generate Image from Text</h3>
                <textarea id="img-prompt" placeholder="Describe the image you want to generate..."></textarea>
                
                <div class="form-row">
                    <div class="half-width">
                        <label for="img-size">Image Size:</label>
                        <select id="img-size">
                            <option value="512x512">512x512</option>
                            <option value="768x768" selected>768x768</option>
                            <option value="1024x1024">1024x1024</option>
                            <option value="1024x1792">1024x1792 (Portrait)</option>
                            <option value="1792x1024">1792x1024 (Landscape)</option>
                        </select>
                    </div>
                    <div class="half-width">
                        <label for="img-count">Number of Images:</label>
                        <select id="img-count">
                            <option value="1" selected>1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="half-width">
                        <label for="img-style">Style:</label>
                        <select id="img-style">
                            <option value="natural" selected>Natural</option>
                            <option value="vivid">Vivid</option>
                            <option value="cinematic">Cinematic</option>
                            <option value="anime">Anime</option>
                            <option value="digital-art">Digital Art</option>
                            <option value="photographic">Photographic</option>
                        </select>
                    </div>
                    <div class="half-width">
                        <label for="img-quality">Quality:</label>
                        <select id="img-quality">
                            <option value="standard">Standard</option>
                            <option value="hd" selected>HD</option>
                        </select>
                    </div>
                </div>
                
                <button id="generate-img-btn">Generate</button>
                <div id="img-result"></div>
            </div>
        </div>

        <!-- Modal for renaming conversations -->
        <div id="rename-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Rename Conversation</h3>
                <input type="text" id="conversation-name" placeholder="Enter a name for this conversation">
                <button id="save-name-btn">Save</button>
            </div>
        </div>

        <!-- Chat History Modal -->
        <div id="chat-history-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Chat History</h3>
                <div id="conversations-list"></div>
                <div class="modal-buttons">
                    <button id="save-chat-history-btn">Save</button>
                </div>
            </div>
        </div>

        <!-- Image Upload Modal -->
        <div id="image-upload-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Upload Image</h3>
                <input type="file" id="utility-image-upload" accept="image/*" multiple>
                <div class="image-upload-options">
                    <label class="switch">
                        <input type="checkbox" id="base64-toggle">
                        <span class="slider round"></span>
                    </label>
                    <span>Convert to Base64</span>
                </div>
                <div class="image-upload-container">
                    <div id="utility-preview-container" class="image-thumbnails"></div>
                </div>
                <div class="modal-buttons">
                    <button id="save-image-upload-btn">Submit</button>
                </div>
            </div>
        </div>

        <!-- File Upload Modal -->
        <div id="file-upload-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Upload File</h3>
                <input type="file" id="file-upload" multiple>
                <div class="file-upload-container">
                    <div id="file-thumbnails" class="file-thumbnails"></div>
                </div>
                <div class="modal-buttons">
                    <button id="save-file-upload-btn">Submit</button>
                </div>
            </div>
        </div>

        <!-- Knowledge Base Modal -->
        <div id="knowledge-base-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Knowledge Base</h3>
                <div class="kb-actions">
                    <button id="upload-kb-file-btn" class="feature-btn">Upload File</button>
                    <button id="input-kb-text-btn" class="feature-btn">Input Text</button>
                </div>

                <div class="kb-container">
                    <div class="kb-list">
                        <div class="kb-item">
                            <div class="kb-info">
                                <div class="kb-title">Company Handbook</div>
                                <div class="kb-calling">@handbook</div>
                            </div>
                            <div class="kb-actions">
                                <button class="kb-view-btn">View</button>
                                <button class="kb-delete-btn">Delete</button>
                            </div>
                        </div>
                        <div class="kb-item">
                            <div class="kb-info">
                                <div class="kb-title">Product Specifications</div>
                                <div class="kb-calling">@specs</div>
                            </div>
                            <div class="kb-actions">
                                <button class="kb-view-btn">View</button>
                                <button class="kb-delete-btn">Delete</button>
                            </div>
                        </div>
                        <div class="kb-item">
                            <div class="kb-info">
                                <div class="kb-title">Customer FAQ</div>
                                <div class="kb-calling">@faq</div>
                            </div>
                            <div class="kb-actions">
                                <button class="kb-view-btn">View</button>
                                <button class="kb-delete-btn">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-buttons">
                    <button id="save-knowledge-base-btn">Save</button>
                </div>
            </div>
        </div>

        <!-- KB File Upload Modal -->
        <div id="kb-file-upload-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Upload Knowledge Base File</h3>
                <div class="kb-upload-form">
                    <div class="form-group">
                        <label for="kb-calling">Calling @:</label>
                        <input type="text" id="kb-calling" placeholder="Enter function name (e.g., handbook)">
                    </div>
                    <div class="form-group">
                        <label for="kb-title">Title:</label>
                        <input type="text" id="kb-title" placeholder="Enter a title for this document">
                    </div>
                    <div class="form-group">
                        <label for="kb-file-upload">File:</label>
                        <input type="file" id="kb-file-upload">
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="save-kb-file-btn">Upload</button>
                </div>
            </div>
        </div>

        <!-- KB Text Input Modal -->
        <div id="kb-text-input-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Input Knowledge Base Text</h3>
                <div class="kb-text-form">
                    <div class="form-group">
                        <label for="kb-text-calling">Calling @:</label>
                        <input type="text" id="kb-text-calling" placeholder="Enter function name (e.g., notes)">
                    </div>
                    <div class="form-group">
                        <label for="kb-text-title">Title:</label>
                        <input type="text" id="kb-text-title" placeholder="Enter a title for this text">
                    </div>
                    <div class="form-group">
                        <label for="kb-text-content">Content:</label>
                        <textarea id="kb-text-content" placeholder="Enter or paste your text here..."></textarea>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="save-kb-text-btn">Save</button>
                </div>
            </div>
        </div>

        <!-- Reasoning Modal -->
        <div id="reasoning-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Reasoning Settings</h3>
                <div class="reasoning-settings">
                    <div class="setting-section">
                        <h4>Reasoning Model</h4>
                        <select id="reasoning-model">
                            <option value="deepseek-reasoner">DeepSeek Reasoner</option>
                            <option value="claude-3-5-sonnet">Claude 3.5 Sonnet</option>
                            <option value="o3-mini">O3 Mini</option>
                            <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                        </select>
                        <button id="activate-reasoning" class="feature-btn">Activate Reasoning</button>
                    </div>

                    <div class="setting-section">
                        <h4>Reasoning Prompts</h4>
                        <div class="prompt-search-container">
                            <input type="text" id="prompt-search" placeholder="Search for prompts...">
                            <button id="fetch-prompts-btn" class="feature-btn">Fetch Prompts</button>
                        </div>
                        <div class="reasoning-prompts">
                            <div class="reasoning-prompt">
                                <input type="radio" name="reasoning-prompt" id="prompt-1" checked>
                                <label for="prompt-1">Step-by-step thinking</label>
                                <button class="edit-prompt-btn"><i class="fas fa-edit"></i></button>
                            </div>
                            <div class="reasoning-prompt">
                                <input type="radio" name="reasoning-prompt" id="prompt-2">
                                <label for="prompt-2">Chain of thought</label>
                                <button class="edit-prompt-btn"><i class="fas fa-edit"></i></button>
                            </div>
                            <div class="reasoning-prompt">
                                <input type="radio" name="reasoning-prompt" id="prompt-3">
                                <label for="prompt-3">Detailed analysis</label>
                                <button class="edit-prompt-btn"><i class="fas fa-edit"></i></button>
                            </div>
                        </div>
                        <button id="add-prompt-btn" class="feature-btn">+ Add Prompt</button>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="save-reasoning-btn">Save</button>
                </div>
            </div>
        </div>

        <!-- Add Prompt Modal -->
        <div id="add-prompt-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Add Reasoning Prompt</h3>
                <div class="prompt-form">
                    <div class="form-group">
                        <label for="prompt-title">Prompt Title:</label>
                        <input type="text" id="prompt-title" placeholder="Enter a title for this prompt">
                    </div>
                    <div class="form-group">
                        <label for="prompt-text">Prompt Text:</label>
                        <textarea id="prompt-text" placeholder="Enter the reasoning prompt..."></textarea>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="save-prompt-btn">Save Prompt</button>
                </div>
            </div>
        </div>

        <!-- Web URL Modal -->
        <div id="web-url-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Web URL</h3>
                <div class="url-input-container">
                    <input type="url" id="web-url-input" placeholder="Enter URL to analyze">
                </div>
                <button id="load-url-btn" class="feature-btn">Load</button>

                <div id="url-preview-container" style="display: none;">
                    <div class="url-preview">
                        <img id="url-thumbnail" src="" alt="Website preview">
                        <div id="url-title"></div>
                    </div>

                    <div class="url-actions">
                        <button id="scrape-url-btn" class="feature-btn">Scrape Webpage</button>
                        <button id="add-url-to-chat-btn" class="feature-btn">Add to Chat</button>
                        <button id="extract-data-btn" class="feature-btn">Extract Data</button>
                    </div>
                </div>

                <div id="extract-options" class="extract-options" style="display: none;">
                    <button class="extract-option" data-type="text">Text</button>
                    <button class="extract-option" data-type="images">Images</button>
                    <button class="extract-option" data-type="code">Page Code</button>
                </div>

                <div id="extracted-data-container" style="display: none;">
                    <div class="extracted-text-box">
                        <div class="extracted-text-header">
                            <span id="extracted-data-type">Extracted Text</span>
                            <button id="copy-extracted-data" class="small-btn"><i class="fas fa-copy"></i> Copy</button>
                        </div>
                        <div id="extracted-text-content" class="extracted-text-content"></div>
                    </div>
                    <div id="extracted-images-container" class="extracted-images-container" style="display: none;">
                        <div class="image-navigation">
                            <button id="prev-image" class="nav-btn"><i class="fas fa-chevron-left"></i></button>
                            <span id="image-counter">1 / 1</span>
                            <button id="next-image" class="nav-btn"><i class="fas fa-chevron-right"></i></button>
                        </div>
                        <div class="image-display">
                            <img id="current-extracted-image" src="" alt="Extracted image">
                        </div>
                        <button id="download-image" class="feature-btn"><i class="fas fa-download"></i> Download</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tools Modal -->
        <div id="tools-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Tools</h3>
                <div class="tools-search">
                    <input type="text" id="tools-search-input" placeholder="Search for tools...">
                    <div class="search-sources">
                        <label><input type="checkbox" class="search-source" value="github" checked> GitHub</label>
                        <label><input type="checkbox" class="search-source" value="reddit" checked> Reddit</label>
                        <label><input type="checkbox" class="search-source" value="google" checked> Google</label>
                    </div>
                    <button id="search-tools-btn" class="feature-btn">Search</button>
                </div>

                <div class="tools-container">
                    <div class="tools-list">
                        <div class="tool-item">
                            <div class="tool-header">
                                <input type="checkbox" id="tool-weather" checked>
                                <label for="tool-weather">Weather</label>
                                <button class="tool-expand-btn"><i class="fas fa-chevron-down"></i></button>
                            </div>
                            <span class="tool-description">Get current weather for any location</span>
                            <div class="tool-details" style="display: none;">
                                <div class="tool-usage">
                                    <h4>Usage:</h4>
                                    <p>Get weather information for any location by asking about the weather.</p>
                                    <h4>Examples:</h4>
                                    <ul>
                                        <li>What's the weather like in New York?</li>
                                        <li>Will it rain in London tomorrow?</li>
                                    </ul>
                                    <h4>Call:</h4>
                                    <code>@weather [location]</code>
                                </div>
                            </div>
                        </div>
                        <div class="tool-item">
                            <div class="tool-header">
                                <input type="checkbox" id="tool-calculator">
                                <label for="tool-calculator">Calculator</label>
                                <button class="tool-expand-btn"><i class="fas fa-chevron-down"></i></button>
                            </div>
                            <span class="tool-description">Perform complex calculations</span>
                            <div class="tool-details" style="display: none;">
                                <div class="tool-usage">
                                    <h4>Usage:</h4>
                                    <p>Perform mathematical calculations with precision.</p>
                                    <h4>Examples:</h4>
                                    <ul>
                                        <li>Calculate 15% of 67.89</li>
                                        <li>What is the square root of 144?</li>
                                    </ul>
                                    <h4>Call:</h4>
                                    <code>@calc [expression]</code>
                                </div>
                            </div>
                        </div>
                        <div class="tool-item">
                            <div class="tool-header">
                                <input type="checkbox" id="tool-search">
                                <label for="tool-search">Web Search</label>
                                <button class="tool-expand-btn"><i class="fas fa-chevron-down"></i></button>
                            </div>
                            <span class="tool-description">Search the web for information</span>
                            <div class="tool-details" style="display: none;">
                                <div class="tool-usage">
                                    <h4>Usage:</h4>
                                    <p>Search the web for up-to-date information.</p>
                                    <h4>Examples:</h4>
                                    <ul>
                                        <li>Search for latest news about AI</li>
                                        <li>Find information about climate change</li>
                                    </ul>
                                    <h4>Call:</h4>
                                    <code>@search [query]</code>
                                </div>
                            </div>
                        </div>
                        <div class="tool-item">
                            <div class="tool-header">
                                <input type="checkbox" id="tool-calendar">
                                <label for="tool-calendar">Calendar</label>
                                <button class="tool-expand-btn"><i class="fas fa-chevron-down"></i></button>
                            </div>
                            <span class="tool-description">Manage calendar events</span>
                            <div class="tool-details" style="display: none;">
                                <div class="tool-usage">
                                    <h4>Usage:</h4>
                                    <p>Create, view, and manage calendar events.</p>
                                    <h4>Examples:</h4>
                                    <ul>
                                        <li>Schedule a meeting for tomorrow at 2pm</li>
                                        <li>What events do I have next week?</li>
                                    </ul>
                                    <h4>Call:</h4>
                                    <code>@calendar [action] [details]</code>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="search-results-container" style="display: none;">
                    <h4>Search Results</h4>
                    <div id="tools-search-results" class="tools-search-results">
                        <!-- Search results will be populated here -->
                    </div>
                </div>

                <div class="tools-actions">
                    <button id="install-tool-btn" class="feature-btn">+ Install New Tool</button>
                </div>

                <div class="modal-buttons">
                    <button id="save-tools-btn">Save</button>
                </div>
            </div>
        </div>

        <!-- MCP Modal -->
        <div id="mcp-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>MCP Servers</h3>

                <div class="mcp-tabs">
                    <button class="mcp-tab-btn active" data-tab="search">Search</button>
                    <button class="mcp-tab-btn" data-tab="installed">Installed</button>
                </div>

                <!-- Search Tab -->
                <div class="mcp-tab-content active" id="search-tab">
                    <div class="mcp-search">
                        <input type="text" id="mcp-search-input" placeholder="Search for MCP servers...">
                        <div class="search-sources">
                            <label><input type="checkbox" class="mcp-search-source" value="github" checked> GitHub</label>
                            <label><input type="checkbox" class="mcp-search-source" value="mcp.so" checked> MCP.so</label>
                            <label><input type="checkbox" class="mcp-search-source" value="reddit" checked> Reddit</label>
                            <label><input type="checkbox" class="mcp-search-source" value="google" checked> Google</label>
                        </div>
                        <button id="search-mcp-btn" class="feature-btn">Search</button>
                    </div>

                    <div class="mcp-container">
                        <div class="mcp-list" id="mcp-search-results">
                            <div class="mcp-loading">Search for available MCP servers...</div>
                        </div>
                    </div>
                </div>

                <!-- Installed Tab -->
                <div class="mcp-tab-content" id="installed-tab">
                    <div class="mcp-container">
                        <div class="mcp-list" id="mcp-installed-list">
                            <div class="mcp-item">
                                <div class="mcp-status-indicator green"></div>
                                <div class="mcp-info">
                                    <label>Local MCP</label>
                                    <span class="mcp-description">Process data locally on your device</span>
                                </div>
                                <div class="mcp-controls">
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="slider round"></span>
                                    </label>
                                    <button class="mcp-delete-btn"><i class="fas fa-trash"></i></button>
                                </div>
                                <button class="mcp-expand-btn"><i class="fas fa-chevron-down"></i></button>
                                <div class="mcp-details" style="display: none;">
                                    <div class="mcp-functions">
                                        <h4>Available Functions:</h4>
                                        <div class="mcp-function-item">
                                            <div class="mcp-function-name">processText</div>
                                            <div class="mcp-function-description">Process and analyze text data locally</div>
                                        </div>
                                        <div class="mcp-function-item">
                                            <div class="mcp-function-name">analyzeImage</div>
                                            <div class="mcp-function-description">Analyze image content locally</div>
                                        </div>
                                    </div>
                                    <div class="mcp-usage">
                                        <h4>Usage:</h4>
                                        <code>@local [function] [parameters]</code>
                                    </div>
                                </div>
                            </div>
                            <div class="mcp-item">
                                <div class="mcp-status-indicator orange"></div>
                                <div class="mcp-info">
                                    <label>Cloud MCP</label>
                                    <span class="mcp-description">Process data in the cloud for better performance</span>
                                </div>
                                <div class="mcp-controls">
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="slider round"></span>
                                    </label>
                                    <button class="mcp-delete-btn"><i class="fas fa-trash"></i></button>
                                </div>
                                <button class="mcp-expand-btn"><i class="fas fa-chevron-down"></i></button>
                                <div class="mcp-details" style="display: none;">
                                    <div class="mcp-functions">
                                        <h4>Available Functions:</h4>
                                        <div class="mcp-function-item">
                                            <div class="mcp-function-name">processData</div>
                                            <div class="mcp-function-description">Process large datasets in the cloud</div>
                                        </div>
                                        <div class="mcp-function-item">
                                            <div class="mcp-function-name">generateReport</div>
                                            <div class="mcp-function-description">Generate comprehensive reports</div>
                                        </div>
                                    </div>
                                    <div class="mcp-usage">
                                        <h4>Usage:</h4>
                                        <code>@cloud [function] [parameters]</code>
                                    </div>
                                </div>
                            </div>
                            <div class="mcp-item">
                                <div class="mcp-status-indicator red"></div>
                                <div class="mcp-info">
                                    <label>Hybrid MCP</label>
                                    <span class="mcp-description">Combine local and cloud processing</span>
                                </div>
                                <div class="mcp-controls">
                                    <label class="switch">
                                        <input type="checkbox">
                                        <span class="slider round"></span>
                                    </label>
                                    <button class="mcp-delete-btn"><i class="fas fa-trash"></i></button>
                                </div>
                                <button class="mcp-expand-btn"><i class="fas fa-chevron-down"></i></button>
                                <div class="mcp-details" style="display: none;">
                                    <div class="mcp-functions">
                                        <h4>Available Functions:</h4>
                                        <div class="mcp-function-item">
                                            <div class="mcp-function-name">smartProcess</div>
                                            <div class="mcp-function-description">Intelligently choose between local and cloud processing</div>
                                        </div>
                                        <div class="mcp-function-item">
                                            <div class="mcp-function-name">distributedCompute</div>
                                            <div class="mcp-function-description">Distribute computation across local and cloud resources</div>
                                        </div>
                                    </div>
                                    <div class="mcp-usage">
                                        <h4>Usage:</h4>
                                        <code>@hybrid [function] [parameters]</code>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mcp-actions">
                    <button id="add-mcp-server-btn" class="feature-btn">+ Add MCP Server</button>
                </div>

                <div class="modal-buttons">
                    <button id="save-mcp-btn">Save</button>
                </div>
            </div>
        </div>

        <!-- AI Features Modal -->
        <div id="ai-features-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>AI Features</h3>

                <div class="settings-tabs">
                    <button class="tab-btn active" data-tab="features">Features</button>
                    <button class="tab-btn" data-tab="agents">Agents</button>
                </div>

                <!-- Features Tab -->
                <div class="tab-content active" id="features-tab">
                    <div class="feature-section">
                        <div class="setting-option">
                            <label for="stream-toggle-switch">Enable Streaming:</label>
                            <label class="switch">
                                <input type="checkbox" id="stream-toggle-switch">
                                <span class="slider round"></span>
                            </label>
                        </div>

                        <div class="ai-feature-buttons">
                            <button id="txt2img-feature-btn" class="feature-btn"><i class="fas fa-image"></i> Generate Image</button>
                            <button id="img2txt-feature-btn" class="feature-btn"><i class="fas fa-file-alt"></i> Extract Text from Image</button>
                            <button id="txt2speech-feature-btn" class="feature-btn"><i class="fas fa-volume-up"></i> Text to Speech</button>
                        </div>
                    </div>
                </div>

                <!-- Agents Tab -->
                <div class="tab-content" id="agents-tab">
                    <div class="agents-search">
                        <input type="text" id="agents-search-input" placeholder="Search for agents...">
                        <div class="search-sources">
                            <label><input type="checkbox" class="agent-search-source" value="github" checked> GitHub</label>
                            <label><input type="checkbox" class="agent-search-source" value="reddit" checked> Reddit</label>
                            <label><input type="checkbox" class="agent-search-source" value="google" checked> Google</label>
                        </div>
                        <button id="search-agents-btn" class="feature-btn">Search</button>
                    </div>
                    
                    <div id="agents-search-results" style="display: none;">
                        <h4>Search Results</h4>
                        <div class="agents-search-results-list">
                            <!-- Search results will be populated here -->
                        </div>
                    </div>
                    
                    <div class="agents-container">
                        <div class="agents-list">
                            <div class="agent-item">
                                <div class="agent-info">
                                    <div class="agent-name">/fix</div>
                                    <div class="agent-description">Fixes code problems or questions</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <button class="agent-delete-btn"><i class="fas fa-trash"></i></button>
                            </div>

                            <div class="agent-item">
                                <div class="agent-info">
                                    <div class="agent-name">/review</div>
                                    <div class="agent-description">Reviews text, files or images</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <button class="agent-delete-btn"><i class="fas fa-trash"></i></button>
                            </div>

                            <div class="agent-item">
                                <div class="agent-info">
                                    <div class="agent-name">/plan</div>
                                    <div class="agent-description">Plans around questions, code, trips, etc.</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <button class="agent-delete-btn"><i class="fas fa-trash"></i></button>
                            </div>

                            <div class="agent-item">
                                <div class="agent-info">
                                    <div class="agent-name">/suggest</div>
                                    <div class="agent-description">Suggests improvements for code, writing, etc.</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <button class="agent-delete-btn"><i class="fas fa-trash"></i></button>
                            </div>

                            <div class="agent-item">
                                <div class="agent-info">
                                    <div class="agent-name">/find</div>
                                    <div class="agent-description">Finds information from knowledge base, chat or web</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <button class="agent-delete-btn"><i class="fas fa-trash"></i></button>
                            </div>

                            <div class="agent-item">
                                <div class="agent-info">
                                    <div class="agent-name">/code</div>
                                    <div class="agent-description">Codes a task as requested</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <button class="agent-delete-btn"><i class="fas fa-trash"></i></button>
                            </div>

                            <div class="agent-item">
                                <div class="agent-info">
                                    <div class="agent-name">/edit</div>
                                    <div class="agent-description">Edits text, prompts, code or files</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <button class="agent-delete-btn"><i class="fas fa-trash"></i></button>
                            </div>

                            <div class="agent-item">
                                <div class="agent-info">
                                    <div class="agent-name">/generate</div>
                                    <div class="agent-description">Generates code, stories, images, etc.</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <button class="agent-delete-btn"><i class="fas fa-trash"></i></button>
                            </div>

                            <div class="agent-item">
                                <div class="agent-info">
                                    <div class="agent-name">/note</div>
                                    <div class="agent-description">Takes notes and adds to knowledge base</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <button class="agent-delete-btn"><i class="fas fa-trash"></i></button>
                            </div>

                            <div class="agent-item">
                                <div class="agent-info">
                                    <div class="agent-name">/knowledge</div>
                                    <div class="agent-description">Refers to knowledge base for answers</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <button class="agent-delete-btn"><i class="fas fa-trash"></i></button>
                            </div>

                            <div class="agent-item">
                                <div class="agent-info">
                                    <div class="agent-name">/tool</div>
                                    <div class="agent-description">Uses appropriate tools for requests</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <button class="agent-delete-btn"><i class="fas fa-trash"></i></button>
                            </div>

                            <div class="agent-item">
                                <div class="agent-info">
                                    <div class="agent-name">/build</div>
                                    <div class="agent-description">Acts upon previous planned messages</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <button class="agent-delete-btn"><i class="fas fa-trash"></i></button>
                            </div>

                            <div class="agent-item">
                                <div class="agent-info">
                                    <div class="agent-name">/talk</div>
                                    <div class="agent-description">Uses text-to-speech to read messages</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <button class="agent-delete-btn"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>

                        <div class="agents-actions">
                            <button id="new-agent-btn" class="feature-btn">+ New Agent</button>
                        </div>
                    </div>
                </div>

                <div class="modal-buttons">
                    <button id="save-ai-features-btn">Save</button>
                </div>
            </div>
        </div>

        <!-- New Agent Modal -->
        <div id="new-agent-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Create New Agent</h3>

                <div class="form-group">
                    <label for="agent-calling">Calling (with /):</label>
                    <input type="text" id="agent-calling" placeholder="/command">
                </div>

                <div class="form-group">
                    <label for="agent-name">Name:</label>
                    <input type="text" id="agent-name" placeholder="Agent Name">
                </div>

                <div class="form-group">
                    <label for="agent-instructions">Instructions:</label>
                    <textarea id="agent-instructions" placeholder="What should this agent do?"></textarea>
                </div>

                <div class="form-group">
                    <label for="agent-prompt">Prompt:</label>
                    <textarea id="agent-prompt" placeholder="System prompt for this agent"></textarea>
                </div>

                <div class="modal-buttons">
                    <button id="save-new-agent-btn">Save Agent</button>
                    <button id="cancel-new-agent-btn">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Code Editor Modal -->
        <div id="code-editor-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>Code Editor</h3>
                
                <div class="code-editor-header">
                    <div class="form-group">
                        <label for="code-filename">Filename:</label>
                        <input type="text" id="code-filename" placeholder="Enter filename (e.g., script.js)">
                    </div>
                    <div class="form-group">
                        <label for="code-language">Language:</label>
                        <select id="code-language">
                            <option value="javascript">JavaScript</option>
                            <option value="html">HTML</option>
                            <option value="css">CSS</option>
                            <option value="python">Python</option>
                            <option value="java">Java</option>
                            <option value="csharp">C#</option>
                            <option value="cpp">C++</option>
                            <option value="php">PHP</option>
                            <option value="ruby">Ruby</option>
                            <option value="go">Go</option>
                            <option value="rust">Rust</option>
                            <option value="swift">Swift</option>
                            <option value="typescript">TypeScript</option>
                            <option value="sql">SQL</option>
                            <option value="shell">Shell/Bash</option>
                            <option value="markdown">Markdown</option>
                            <option value="json">JSON</option>
                            <option value="xml">XML</option>
                            <option value="yaml">YAML</option>
                        </select>
                    </div>
                </div>
                
                <div id="code-editor-container" class="code-editor-container"></div>
                
                <div class="modal-buttons">
                    <button id="save-code-btn">Save to Chat</button>
                    <button id="copy-code-btn">Copy Code</button>
                    <button id="clear-code-btn">Clear</button>
                </div>
            </div>
        </div>

        <!-- Extract Data Modal -->
        <div id="extract-data-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3 id="extract-data-title">Extracted Data</h3>
                
                <div id="extract-data-content" class="extract-data-content"></div>
                
                <div class="modal-buttons">
                    <button id="copy-extracted-data-btn">Copy</button>
                    <button id="close-extract-data-btn">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Include highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="app.js"></script>
</body>
</html>